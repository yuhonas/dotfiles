- name: update homebrew
  homebrew: update_homebrew=yes

- name: applications
  homebrew_cask: name={{ item }} state=present
  with_items:
    - 1password
    - alfred
    # - bitbar
    # - drop-to-gif
    - karabiner-elements
    - google-drive
    # - handbrake
    # - insomnia
    - rectangle
    - signal
    - spotify
    - tor-browser
    - uninstallpkg
    - vlc

# the version of bash that ships with macos (3.2.x) at the time
# is super old and breaks the tmux fingers plugin
- name: install a modern version of bash
  homebrew: name=bash state=present

- name: developer applications
  homebrew_cask: name={{ item }} state=present
  with_items:
    - kitty
    - postico
    - visual-studio-code

- name: ensure we have a directory for custom key bindings
  file: path={{ ansible_env.HOME }}/Library/KeyBindings state=directory mode=700

# copy custom macos keybindings
# symlinking causes issues in some apps
# see https://itectec.com/askdifferent/textedit-key-bindings-modified-in-defaultkeybinding-dict-stopped-working/
- name: copying DefaultKeyBinding for custom key bindings in osx text inputs
  copy:
    src: KeyBindings/DefaultKeyBinding.dict
    dest: "{{ ansible_env.HOME }}/Library/KeyBindings"
    mode: 0644

- name: quicklook plugins
  homebrew_cask: name={{ item }} state=present
  with_items:
    - betterzip
    - qlmarkdown
#     - qlcolorcode # https://github.com/anthonygelibert/QLColorCode/issues/88#issuecomment-927783435
#     - qlstephen # https://github.com/whomwah/qlstephen/issues/133
#     - quicklook-json # TODO: Verify this works on M1/Apple Silicon

# - name: link qt
#   homebrew: name=qt state=linked

# - name: create alfred configuration directory
#   file:
#     path: "{{ ansible_env.HOME }}/Library/Application Support/Alfred 3/Alfred.alfredpreferences/preferences/features/websearch"
#     mode: 0644
#     state: directory

# - name: symlink alfred configuration
#   file:
#     src: "{{ role_path }}/files/alfred/prefs.plist"
#     dest: "{{ ansible_env.HOME }}/Library/Application Support/Alfred 3/Alfred.alfredpreferences/preferences/features/websearch/prefs.plist"
#     state: link
#     force: true
